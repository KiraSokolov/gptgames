<!DOCTYPE html>
<html>
<head>
  <title>Who Wants to Be a Millionaire</title>
  <script src="https://unpkg.com/json5@2/dist/index.min.js"></script>
  <style>
    :root {
      --primary-color: #007bff;
      --secondary-color: #6c757d;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      background-color: #f7f7f7;
    }

    .container {
      margin: 20px auto;
      max-width: 800px;
      background-color: #fff;
      border: 1px solid rgba(0, 0, 0, 0.125);
      border-radius: 5px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
      overflow: hidden;
    }

    .header {
      background-color: var(--primary-color);
      padding: 15px;
      text-align: center;
      color: #fff;
    }

    .header h1 {
      margin: 0;
    }

    .main {
      padding: 20px;
    }

    .main .question-container {
      border-bottom: 1px solid #ddd;
      margin: 20px 0;
      padding-bottom: 20px;
      text-align: center;
    }

    .main .question-container p {
      font-size: 24px;
      font-weight: bold;
      margin: 0;
    }

    .main .options-container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
      margin-bottom: 20px;
    }

    .main .option {
      background-color: #ddd;
      border-radius: 5px;
      padding: 10px;
      text-align: center;
      font-size: 18px;
      font-weight: bold;
      flex-basis: 45%;
      cursor: pointer;
    }

    .main .option:hover {
      background-color: #ccc;
    }

    .main .option.correct {
      background-color: var(--primary-color);
      color: #fff;
    }

    .main .option.incorrect {
      background-color: #dc3545;
      color: #fff;
    }

    .controls {
      text-align: center;
      margin-bottom: 20px;
    }

    .controls .btn {
      background-color: var(--primary-color);
      border: none;
      border-radius: 5px;
      color: #fff;
      padding: 10px 20px;
      margin-right: 10px;
      cursor: pointer;
    }

    .controls .btn:hover {
      background-color: #0069d9;
    }

    .controls .btn:active {
      outline: none;
      box-shadow: none;
    }

    .controls .btn:disabled {
      background-color: #b9b9b9;
    }

    .result-box {
      padding: 20px;
      margin: 20px;
      background-color: #fff;
      border: 1px solid #ddd;
      border-radius: 5px;
      text-align: center;
    }

    .result-box p {
      font-size: 18px;
      margin-bottom: 10px;
    }

    .result-box p span {
      font-weight: bold;
      font-size: 24px;
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>Who Wants to Be a Millionaire</h1>
  </div>
  <div class="main">
    <div class="question-container">
      <p class="question"></p>
    </div>
    <div class="options-container">
      <div class="option option1"></div>
      <div class="option option2"></div>
      <div class="option option3"></div>
      <div class="option option4"></div>
    </div>
    <div class="controls">
      <button class="btn start">Start</button>
      <button class="btn next">Next Question</button>
      <button class="btn finish">Finish</button>
    </div>
    <div class="result-box hidden">
      <p class="result-message"></p>
      <p>Your current score is <span class="total-score"></span>$!</p>
    </div>
  </div>
</div>
<script type="text/javascript">
  const startButton = document.querySelector('.start');
  const nextButton = document.querySelector('.next');
  const finishButton = document.querySelector('.finish');
  const questionContainer = document.querySelector('.question');
  const optionsContainer = document.querySelector('.options-container');
  const resultBox = document.querySelector('.result-box');
  const resultMessage = resultBox.querySelector('.result-message');
  const totalScore = resultBox.querySelector('.total-score');
  const earnings = [ 0, 100, 200, 300, 500, 1_000, 2_000, 4_000, 8_000, 16_000, 32_000, 64_000, 125_000, 250_000, 500_000, 1_000_000 ];

  let currentQuestion = {};
  let acceptingAnswers = false;
  let score = 0;
  let questionCounter = 0;
  let availableQuestions = [];

  const apiUrl = 'https://chatgpt.tobiasmue91.workers.dev/';

  // Start button click event listener
  startButton.addEventListener('click', startGame);

  // Next button click event listener
  nextButton.addEventListener('click', () => {
    questionCounter++;
    getNextQuestion();
  });

  // Finish button click event listener
  finishButton.addEventListener('click', () => {
    endGame();
  });

  // Start the game
  function startGame() {
    // Hide start button
    startButton.classList.add('hidden');

    // Get the first question
    getNextQuestion();

    // Show next and finish buttons
    nextButton.classList.remove('hidden');
    finishButton.classList.remove('hidden');
  }

  // Get the next question
  function getNextQuestion() {
    nextButton.disabled = true;
    // Check if we reached the end of questions list
    if (questionCounter >= availableQuestions.length) {
      endGame();
      return;
    }

    // Get the next question
    currentQuestion = availableQuestions[questionCounter];

    // Display the question
    questionContainer.innerText = `${questionCounter+1}/${availableQuestions.length}: ${currentQuestion['question']}`;

    // Display the answer options
    const options = currentQuestion['answers'];
    options.forEach((option, index) => {
      const optionElement = optionsContainer.children[index];
      optionElement.innerText = option;
      optionElement.classList.remove('correct', 'incorrect');
      optionElement.removeEventListener('click', checkAnswer);
      optionElement.addEventListener('click', checkAnswer);
    });

    // Allow answers
    acceptingAnswers = true;
  }

  // Check if the answer is correct
  function checkAnswer(event) {
    finishButton.disabled = false;
    if (!acceptingAnswers) {
      return;
    }

    resultBox.classList.remove('hidden');

    const selectedOption = event.target;
    const selectedAnswer = selectedOption.innerText;
    const correctAnswer = currentQuestion['correct_answer'];

    // Update score and display result
    const isCorrect = selectedAnswer === correctAnswer;
    if (isCorrect) {
      selectedOption.classList.add('correct');
      score = earnings[questionCounter+1];
      resultMessage.innerText = 'Correct!';
      nextButton.disabled = false;
    } else {
      selectedOption.classList.add('incorrect');
      resultMessage.innerText = 'Wrong!';
    }

    // Update total score
    totalScore.innerText = ` ${score}`;

    // Prevent further answering
    acceptingAnswers = false;
  }

  // End the game
  function endGame() {
    // Hide next and finish button
    nextButton.classList.add('hidden');
    finishButton.classList.add('hidden');

    // Show result message and score
    resultBox.classList.remove('hidden');
    resultMessage.innerText = `You answered ${questionCounter+1} questions correctly out of ${availableQuestions.length}!`;

    // Reset score and questions counter
    score = 0;
    questionCounter = 0;

    // Show start button
    startButton.classList.remove('hidden');
  }

  function getMessageData() {
    const messages = [
      {
        role: "assistant",
        content: `I am now an API for the "Who wants to be a Millionaire?" online game. From now on I will respond in JSON format and provide an array of exactly 15 questions with 4 answers each of which one is the correct answer. The questions will be sorted from easiest to hardest. I will try my best to make the last questions very hard. I will only use questions that I know the factual answer to. The JSON format will be as follows: {"questions":[{"question":"QUESTION?","answers":["ANSWER1","ANSWER2","ANSWER3","ANSWER4"],"correct_answer":"ANSWER3"}, ...]}. Please confirm with "OCK!" and I will send you the questions in the next message.`,
      },
      {
        role: "user",
        content: `OCK!`,
      },
    ];

    return messages;
  }


  // Get questions from API and start the game
  async function getQuestions() {
    startButton.disabled = true;
    nextButton.disabled = true;
    finishButton.disabled = true;
    questionContainer.innerText = `Loading Questions. Please wait a moment.`;
    const requestData = {
      model: "gpt-3.5-turbo-0301",
      max_tokens: 1024,
      messages: getMessageData(),
    };
    // Get questions from API
    let response = await fetch(apiUrl, {
      'method': 'POST',
      'headers': {
        "Content-Type": "application/json",
        "Accept": "*/*"
      },
      'body': JSON.stringify(requestData)
    });
    let data = await response.json();
    const responseContent = data.choices[0].message.content;
    const responseJsonStr = responseContent.substring(
            responseContent.indexOf("{"),
            responseContent.lastIndexOf("}") + 1
    );
    const responseJsonData = JSON5.parse(responseJsonStr);
    let questions = responseJsonData['questions'];

    // Format questions data
    availableQuestions = questions.map((question) => ({
      question: question['question'],
      answers: question['answers'],
      correct_answer: question['correct_answer']
    }));

    questionContainer.innerText = `Questions Loaded! Press "Start" to play.`;
    startButton.disabled = false;
  }

  getQuestions();
</script>
</body>
</html>