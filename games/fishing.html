<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Fishing Game</title>
  <style>
      #game-canvas {
          position: absolute;
          left: 0;
          top: 0;
          z-index: 0;
      }

      #score, #time {
          position: absolute;
          left: 10px;
          font-size: 24px;
          color: white;
          z-index: 1;
      }

      #score {
          top: 10px;
      }

      #time {
          top: 40px;
      }

      body {
          margin: 0;
          padding: 0;
          background-color: #2e86c1;
          background-size: cover;
      }

      .fish {
          text-shadow: 0px 0px 5px #000;
          animation-duration: 3s;
          animation-fill-mode: forwards;
      }

      @keyframes caught-fish {
          0% {
              transform: scale(1);
          }
          50% {
              transform: scale(1.2);
          }
          100% {
              transform: scale(1);
          }
      }
      #game-over {
          top: 100px;
          display: none;
      }
  </style>
</head>
<body>
<canvas id="game-canvas" width="800" height="600"></canvas>
<div id="score"></div>
<div id="time"></div>
<div id="game-over">Game Over! Final score: <span id="final-score"></span> Fish caught: <span id="fish-caught"></span></div>
<script type="text/javascript">
  // Game canvas
  const canvas = document.getElementById("game-canvas");
  const scoreEl = document.getElementById("score");
  const timeEl = document.getElementById("time");
  const ctx = canvas.getContext("2d");

  // Game variables
  let score = 0;
  let timeRemaining = 60;
  let fishCaught = 0;
  let lastFishTime = 0;

  // Game elements
  const rodWidth = 10;
  const rodHeight = 50;
  const hookWidth = 10;
  const hookHeight = 20;
  const hookSpeed = 5;
  const fishSpeed = 2;
  const fishSize = 40;
  const fishArray = [];

  // Hook position
  let hookX = canvas.width / 2;
  let hookY = canvas.height - rodHeight;

  function addFish() {
    const rarity = Math.floor(Math.random() * 3);
    const fish = {
      x: Math.random() * (canvas.width - fishSize),
      y: -fishSize,
      emoji: ["üê≥", "üêã", "üê¨", "ü¶≠", "üêü", "üê†", "üê°", "ü¶à", "üêô", "üêö"][Math.floor(Math.random() * 10)],
      rarity: rarity
    };
    fishArray.push(fish);
  }

  // Update the canvas
  function update() {
    // Clear the canvas
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Draw the water
    ctx.fillStyle = "rgba(0, 0, 255, 0.5)";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Draw the fishing rod
    ctx.fillStyle = "brown";
    ctx.fillRect(hookX - rodWidth / 2, hookY - rodHeight, rodWidth, rodHeight);

    // Draw the hook
    ctx.fillStyle = "silver";
    ctx.fillRect(hookX - hookWidth / 2, hookY, hookWidth, hookHeight);

    // Draw the fish
    for (let i = 0; i < fishArray.length; i++) {
      const fish = fishArray[i];
      ctx.font = fishSize + "px serif";
      if (fish.rarity === 0) {
        ctx.fillStyle = "#ffeb3b";
        ctx.shadowColor = "#ffff00";
        ctx.shadowBlur = 10;
      } else if (fish.rarity === 1) {
        ctx.fillStyle = "#4caf50";
        ctx.shadowColor = "#00ff00";
        ctx.shadowBlur = 5;
      } else {
        ctx.fillStyle = "#2196f3";
        ctx.shadowColor = "#00ffff";
        ctx.shadowBlur = 2;
      }
      ctx.fillText(fish.emoji, fish.x, fish.y);
      ctx.shadowBlur = 0;

      // Move the fish down the canvas
      fish.y += fishSpeed;

      // Check if the fish is caught
      if (fish.x - fishSize / 2 < hookX && fish.x + fishSize / 2 > hookX && fish.y > hookY && fish.y < hookY + hookHeight) {
        fishCaught++;
        score += 10 * (fish.rarity + 1);

        // Reset the fish's position
        fish.x = Math.random() * (canvas.width - fishSize);
        fish.y = -fishSize;
        fish.emoji = ["üê≥", "üêã", "üê¨", "ü¶≠", "üêü", "üê†", "üê°", "ü¶à", "üêô", "üêö"][Math.floor(Math.random() * 10)];
        fish.rarity = Math.floor(Math.random() * 3);

        // Visual feedback for catching fish
        const caughtFish = document.createElement("div");
        caughtFish.classList.add("fish");
        caughtFish.classList.add(`fish-${fish.rarity}`);
        caughtFish.innerText = fish.emoji;
        caughtFish.style.position = "absolute";
        caughtFish.style.left = `${hookX}px`;
        caughtFish.style.top = `${hookY}px`;
        document.body.appendChild(caughtFish);
        setTimeout(() => {
          document.body.removeChild(caughtFish);
        }, 3000);
      }

      // Remove the fish from the array if it has gone off the screen
      if (fish.y > canvas.height) {
        fishArray.splice(i, 1);
      }
    }

    // Update the score
    scoreEl.textContent = "Score: " + score;

    // Request the next frame
    requestAnimationFrame(update);
  }

  // End the game
  function endGame() {
    // Update the high score
    const highScore = parseInt(localStorage.getItem("highScore") || "0");
    if (score > highScore) {
      localStorage.setItem("highScore", score.toString());
      alert("New high score: " + score);
    }

    // Show the game over message
    alert("Game over! Final score: " + score + " Fish caught: " + fishCaught);
    location.reload();
  }

  // Handle player input
  function handleInput(event) {
    if (event.type === "touchstart" || event.type === "mousedown") {
      canvas.addEventListener(event.type === "touchstart" ? "touchmove" : "mousemove", moveHook);
      moveHook(event);
    } else if (event.type === "touchend" || event.type === "mouseup") {
      canvas.removeEventListener(event.type === "touchend" ? "touchmove" : "mousemove", moveHook);
    }
  }

  // Move the hook
  function moveHook(event) {
    hookX = event.clientX - canvas.offsetLeft;
    if (hookX < hookWidth / 2) {
      hookX = hookWidth / 2;
    } else if (hookX > canvas.width - hookWidth / 2) {
      hookX = canvas.width - hookWidth / 2;
    }
  }

  // Event listeners
  document.addEventListener("touchstart", handleInput);
  document.addEventListener("mousedown", handleInput);
  document.addEventListener("touchend", handleInput);
  document.addEventListener("mouseup", handleInput);

  // Start the game loop
  requestAnimationFrame(update);

  // Update the time remaining
  setInterval(() => {
    if (timeRemaining > 0) {
      timeRemaining--;

      // Add a new fish every 5 seconds
      if (timeRemaining % 5 === 0 && lastFishTime !== timeRemaining) {
        lastFishTime = timeRemaining;
        addFish();
      }

      // Update the time remaining display
      timeEl.textContent = "Time Remaining: " + timeRemaining;
    } else {
      endGame();
    }
  }, 1000);
</script>
</body>
</html>