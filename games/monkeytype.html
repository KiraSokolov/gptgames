<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Monkeytype Clone</title>
    <style>
        body {
            background-color: #333333;
            color: #EEEEEE;
            text-align: center;
        }

        #text {
            font-size: 30px;
            color: #AAAAAA;
            background-color: #222222;
            width: 66%;
            margin: 0 auto;
            padding: 10px;
            border-radius: 5px;
            white-space: pre-line;
            visibility: hidden;
            text-align: left;

            overflow-y: scroll;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            line-clamp: 3;
            -webkit-box-orient: vertical;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        #text::-webkit-scrollbar {
            display: none;
        }

        #timer {
            font-size: 24px;
            color: #FFFF00;
        }

        #stats {
            font-size: 24px;
            color: #FFFFFF;
            margin-right: 10px;
        }

        .correct {
            color: #FFFFFF;
        }

        .incorrect {
            color: #FF0000;
        }
    </style>
</head>
<body>
<h1>Monkeytype Clone</h1>
<div id="text"></div>
<div id="timer">30s</div>
<div id="stats"></div>
<script>
    var words = ["tell", "many", "say", "point", "run", "should", "can", "line", "world", "but", "now", "program", "make", "nation", "not", "while", "stand", "there", "hand", "feel", "under", "must", "work", "go", "show", "can", "general", "new", "old", "great", "small", "large", "long", "short", "big", "little", "best", "better", "worst", "worse", "high", "low", "far", "near", "hard", "easy", "fast", "slow", "happy", "sad", "angry", "calm", "friendly", "mean", "brave", "afraid", "tired", "awake", "sick", "healthy", "good", "bad", "right", "wrong", "true", "false", "smart", "stupid", "clean", "dirty", "empty", "full", "busy", "free", "safe", "dangerous"];
    var text = "";
    var index = 0;
    var correctCount = 0;
    var incorrectCount = 0;
    var wordCount = 0;
    var characterCount = 0;
    var startTime = null;
    var timerId = null;
    var textElement = document.getElementById("text");
    var timerElement = document.getElementById("timer");
    var statsElement = document.getElementById("stats");

    function generateText() {
        var rows = [];
        for (var i = 0; i < 12; i++) {
            var wordsInRow = [];
            for (var j = 0; j < 15; j++) {
                var randomIndex = Math.floor(Math.random() * words.length);
                const randomWord = words[randomIndex];
                let characters = '';
                randomWord.split("").forEach((letter) => {
                    characters += `<span class="letter">${letter}</span>`
                });
                wordsInRow.push(characters);
            }
            rows.push(wordsInRow.join("<span class=\"letter\"> </span>"));
        }
        return rows.join("<br><span class=\"letter\"> </span>");
    }

    function updateText() {
        text = generateText();
        let characters = '';
        text.split("").forEach((letter) => {
            characters += `<span class="letter">${letter}</span>`
        });
        textElement.innerHTML = text;
        textElement.style.visibility = "visible";
    }

    function resetStats() {
        correctCount = 0;
        incorrectCount = 0;
        wordCount = 0;
        characterCount = 0;
        statsElement.textContent = "";
    }

    function resetTimer() {
        if (timerId) {
            clearInterval(timerId);
        }
        timerElement.textContent = "30s";
        startTime = null;
        timerId = null;
    }

    function startTimer(event) {
        if (event.target.tagName === "BODY" && !startTime) {
            resetStats();
            resetTimer();
            startTime = Date.now();
            timerId = setInterval(function () {
                var elapsedSeconds = Math.floor((Date.now() - startTime) / 1000);
                var remainingSeconds = 30 - elapsedSeconds;
                if (remainingSeconds <= 0) {
                    clearInterval(timerId);
                    timerElement.textContent = "0s";
                    showStats();
                } else {
                    timerElement.textContent = remainingSeconds + "s";
                }
            }, 1000);
        }
        var typedChar = String.fromCharCode(event.keyCode).toLowerCase();
        var allCharacters = document.querySelectorAll('.letter');
        var currentCharContainer = allCharacters[index];
        var currentChar = currentCharContainer.innerHTML;


        if (event.key === 'Backspace') {
            allCharacters[index - 1].classList.remove('correct');
            allCharacters[index - 1].classList.remove('incorrect');
            index--;
            return;
        } else {
            index++;
        }

        if (currentChar === " ") {
            wordCount++;

            if (wordCount%15 ===0) {
                textElement.scrollTop = wordCount/15 * 40;
            }
        } else {
            characterCount++;
        }
        if (typedChar === currentChar) {
            currentCharContainer.classList.add('correct');
            correctCount++;
        } else {
            currentCharContainer.classList.add('incorrect');
            incorrectCount++;
        }
        if (index === text.length) {
            resetTimer();
            showStats();
        }
    }

    function showStats() {
        var elapsedSeconds = Math.floor((Date.now() - startTime) / 1000);
        var wpm = Math.floor((wordCount / elapsedSeconds) * 60);
        var accuracy = Math.floor((correctCount / (correctCount + incorrectCount)) * 100);
        var statsText = "WPM:" + wpm + " | Accuracy:" + accuracy + "% | Typed Characters:" + characterCount + " (Correct:" + correctCount + ",Incorrect:" + incorrectCount + ")";
        statsElement.textContent = statsText;
    }

    window.addEventListener('keydown', (e) => {
        startTimer(e);
    })

    updateText();
</script>
</body>
</html>