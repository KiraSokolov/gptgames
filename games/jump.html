<html lang="en">
<head>
  <style>
      #score {
          width: 500px;
          text-align: center;
          font-size: 30px;
      }

      body {
          text-align: center;
      }

      #wrapper {
          margin: 0 auto;
          position: relative;
          width: 500px;
      }

      #game-container {
          height: 800px;
          width: 500px;
          display: flex;
          align-items: center;
          justify-content: center;
          border: solid 1px black;
          overflow: hidden;
          position: relative;
          background: url(jumpbg.png) no-repeat center bottom;
          background-size: cover;
      }

      #player {
          font-size: 45px;
          text-shadow: 0 0 1px #000000, 0 0 1px #000000;
          width: 50px;
          height: 50px;
          z-index: 1;
      }

      #game-over {
          font-size: 50px;
          color: #000000;
          text-shadow: 0 0 2px #ffffff, 0 0 2px #ffffff, 0 0 2px #ffffff;
          text-align: center;
          width: 500px;
          position: absolute;
          z-index: 1;
          background: rgba(255, 255, 255, .5);
          top: 200px;
      }

      .platform {
          width: 100px;
          height: 20px;
          background: linear-gradient(to bottom, #483B47, #231821);
          position: absolute;
          z-index: 0;
          box-shadow: 0 0 4px #AAA, 0 0 4px #AAA;
      }
  </style>
  <title>Jumping Game</title>
</head>
<body>
<div id="wrapper">
  <div id="score">Score: 0</div>
  <div id="game-over" style="display: none;">GAME OVER!</div>
  <div id="game-container"></div>
</div>
<script>
  let player;
  let gravity = 0.5;
  let jumpForce = -15;
  let platformCount = 0;
  let platformDistance = 50;
  let platforms = [];
  let score = 0;
  let keysPressed = {
    left: false,
    right: false
  };
  let cameraMovedUp = false;
  let running = true;
  const gameContainer = document.getElementById("game-container");
  const gameOverContainer = document.getElementById("game-over");
  const scoreContainer = document.getElementById("score");
  const containerHeight = gameContainer.clientHeight;
  document.addEventListener("keydown", event => {
      switch (event.code) {
        case "ArrowLeft":
          keysPressed.left = true;
          break;
        case "ArrowRight":
          keysPressed.right = true;
          break;
        case "Space":
          player.jump();
          break;
      }
    }
  );
  document.addEventListener("keyup", event => {
      switch (event.code) {
        case "ArrowLeft":
          keysPressed.left = false;
          break;
        case "ArrowRight":
          keysPressed.right = false;
          break;
      }
    }
  );

  function increaseScore() {
    score++;
    scoreContainer.textContent = `Score: ${score}`;
  }

  class Platform {
    constructor(x, y) {
      this.x = x;
      this.y = y;
      this.i = platformCount;
      this.jumpedOn = false;
      this.element = document.createElement("div");
      this.element.classList.add("platform");
      this.updateStyle();
      gameContainer.appendChild(this.element);
      platformCount++;
    }

    updateStyle() {
      this.element.style.left = `${this.x}px`;
      this.element.style.top = `${this.y}px`;
    }

    moveDown() {
      cameraMovedUp = true;

      if (player.yVelocity < 0) {
        this.y -= player.yVelocity;
      } else {
        player.moveDown();
        return true;
      }

      this.updateStyle();

      if (this.y > containerHeight) {
        this.remove();
      }
      return false;
    }

    remove() {
      this.element.remove();
      platforms.forEach((platform, index) => {
        if (platform.i > index) {
          platform.i -= 1;
        }
      })
      platforms.splice(this.i, 1);
      platformCount--;
    }
  }

  class Player {
    constructor(x, y) {
      this.x = x;
      this.y = y;
      this.element = document.createElement("div");
      this.element.id = 'player';
      this.element.textContent = String.fromCodePoint(0x1F407);
      this.element.style.height = "50px";
      this.element.style.width = "50px";
      this.element.style.position = "absolute";
      this.element.style.left = `${x}px`;
      this.element.style.top = `${y}px`;
      gameContainer.appendChild(this.element);
      this.jump();
    }

    jump() {
      this.yVelocity = jumpForce;
    }

    moveDown() {
      this.y += 1;
    }

    update() {
      if (keysPressed.left) {
        this.x -= 10;

        if (this.x < 0) {
          this.x = 500;
        }
      }
      if (keysPressed.right) {
        this.x += 10;

        if (this.x + 50 > 500) {
          this.x = 0;
        }
      }
      this.yVelocity += gravity;
      const playerUnderLine = this.y >= 200;
      if (playerUnderLine) {
        this.y += this.yVelocity;
      }
      this.element.style.left = `${this.x}px`;
      this.element.style.top = `${this.y}px`;
      platforms.some((platform, i) => {
        let playerTouchesPlatform = this.y + 50 > platform.y && this.y + 50 < platform.y + 20 && this.x + 30 > platform.x && this.x + 30 < platform.x + 100;
        let playerTouchesFloor = this.y + 50 > containerHeight;
        let playerMovesDown = this.yVelocity > 0;
        if (playerMovesDown && (playerTouchesPlatform || playerTouchesFloor)) {
          this.yVelocity = 0;
          player.jump();

          if (playerTouchesPlatform) {
            if (!platform.jumpedOn) {
              platform.jumpedOn = true;
              increaseScore();
            }
          }

          if (playerTouchesFloor && cameraMovedUp) {
            return gameOver();
          }
        }

        if (!playerUnderLine) {
          return platform.moveDown();
        }
      });

      if (platformCount < 30) {
        addPlatform(true, platforms.length);
      }

    }
  }

  function addPlatform(isNew = false, i = 0) {
    platforms.push(new Platform(Math.random() * 300 + 100, containerHeight - (platformCount * platformDistance)));

    if (platformDistance <= 200) {
      platformDistance += 1;
    }
  }

  function startGame() {
    player = new Player(50, containerHeight);
    for (; platformCount < 30;) {
      addPlatform(false, platformCount);
    }
    requestAnimationFrame(update);
  }

  function gameOver() {
    player.yVelocity = 0;
    running = false;
    gameOverContainer.style.display = 'block';
    return true;
  }

  function update() {
    if (running) {
      player.update();
      requestAnimationFrame(update);
    }
  }

  startGame();
</script>
</body>
</html>
