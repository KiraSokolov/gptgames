<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tetris</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
        integrity="sha512-1ycn6IcaQQ40/MKBW2W4Rhis/DbILU74C1vSrLJxCq57o941Ym01SwNsOMqvEBFlcgUa6xLiPY/NS5R+E6ztJQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"/>
  <style>
      body {
          background: #f5f5f5;
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      }

      #tetris {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          height: 100vh;
      }

      .score-board {
          display: flex;
          align-items: center;
          justify-content: space-between;
          margin-bottom: 20px;
          width: 100%;
          max-width: 500px;
          padding: 0 10px;
      }

      canvas {
          border: 1px solid #000;
          background: #fff;
      }

      .controls {
          display: flex;
          align-items: center;
          justify-content: space-between;
          width: 80px;
          margin-top: 20px;
      }

      i {
          font-size: 30px;
          color: #333;
          cursor: pointer;
          transition: transform .2s ease-in-out;
      }

      i:hover {
          transform: scale(1.2);
      }

      i:active {
          transform: scale(0.9);
      }
  </style>
</head>
<body>
<div id="tetris">
  <div class="score-board">
    <h3>Score:</h3>
    <span id="score">0</span>
  </div>
  <canvas id="tetris-board"></canvas>
  <div class="controls">
    <i class="fas fa-arrow-left" id="left"></i>
    <i class="fas fa-arrow-right" id="right"></i>
    <i class="fas fa-arrow-down" id="down"></i>
    <i class="fas fa-arrow-up" id="rotate"></i>
  </div>
</div>
<script type="text/javascript">
  const canvas = document.getElementById('tetris-board');
  const ctx = canvas.getContext('2d');
  const scoreElement = document.getElementById('score');

  const ROW = 20;
  const COLUMN = 10;
  const BLOCK_SIZE = 30;

  canvas.width = COLUMN * BLOCK_SIZE;
  canvas.height = ROW * BLOCK_SIZE;

  const pieces = [
    [1, 1, 1, 1],
    [1, 1, 1, 0,
      1],
    [1, 1, 1, 0,
      0, 0, 1],
    [1, 1, 0, 0,
      1, 1],
    [1, 1, 0, 0,
      0, 1, 1],
    [0, 1, 1, 0,
      1, 1],
    [0, 1, 0, 0,
      1, 1, 1]
  ];

  const colors = [
    '#FF0D72',
    '#0DC2FF',
    '#0DFF72',
    '#F538FF',
    '#FF8E0D'
  ];

  let board = [];

  function init() {
    for (let row = 0; row < ROW; row++) {
      board[row] = [];
      for (let column = 0; column < COLUMN; column++) {
        board[row][column] = 0;
      }
    }
  }

  init();

  let piece = {
    x: 0,
    y: 0,
    blocks: pieces[0],
    color: colors[0]
  };

  function drawBlock(x, y, color) {
    ctx.fillStyle = color;
    ctx.fillRect(x * BLOCK_SIZE, y * BLOCK_SIZE, BLOCK_SIZE, BLOCK_SIZE);
    ctx.strokeStyle = 'black';
    ctx.strokeRect(x * BLOCK_SIZE, y * BLOCK_SIZE, BLOCK_SIZE, BLOCK_SIZE);
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    for (let row = 0; row < ROW; row++) {
      for (let column = 0; column < COLUMN; column++) {
        if (board[row][column]) {
          drawBlock(column, row, colors[board[row][column] - 1]);
        }
      }
    }

    drawBlock(piece.x, piece.y, piece.color);
  }

  function movePiece(direction) {
    if (direction === 'left') {
      piece.x--;
    } else if (direction === 'right') {
      piece.x++;
    } else if (direction === 'down') {
      piece.y++;
    } else if (direction === 'rotate') {
      const blocks = piece.blocks;
      const length = blocks.length;
      const temp = [];

      for (let i = 0; i < length; i++) {
        temp[i] = blocks.filter((_, index) => index === length - 1 - i).map((block) => block);
      }

      piece.blocks = temp;
    }

    if (isCollision()) {
      if (direction === 'left') {
        piece.x++;
      } else if (direction === 'right') {
        piece.x--;
      } else if (direction === 'down') {
        piece.y--;
        addPieceToBoard();
      } else if (direction === 'rotate') {
        const blocks = piece.blocks;
        const length = blocks.length;
        const temp = [];

        for (let i = 0; i < length; i++) {
          temp[i] = blocks.filter((_, index) => index === i).map((block) => block);
        }

        piece.blocks = temp;
      }

      piece = {
        x: 0,
        y: 0,
        blocks: pieces[Math.floor(Math.random() * pieces.length)],
        color: colors[Math.floor(Math.random() * colors.length)]
      };
    }

    draw();
  }

  function isCollision() {
    const blocks = piece.blocks;

    for (let row = 0; row < blocks.length; row++) {
      for (let column = 0; column < blocks[row].length; column++) {
        if (blocks[row][column] && (board[piece.y + row] && board[piece.y + row][piece.x + column]) !== 0) {
          return true;
        }
      }
    }

    return false;
  }

  function addPieceToBoard() {
    const blocks = piece.blocks;

    for (let row = 0; row < blocks.length; row++) {
      for (let column = 0; column < blocks[row].length; column++) {
        if (blocks[row][column]) {
          board[piece.y + row][piece.x + column] = colors.indexOf(piece.color) + 1;
        }
      }
    }
    for (let row = board.length - 1; row >= 0; row--) {
      if (board[row].every((block) => block !== 0)) {
        for (let r = row; r >= 0; r--) {
          for (let c = 0; c < COLUMN; c++) {
            if (r === 0) {
              board[r][c] = 0;
            } else {
              board[r][c] = board[r - 1][c];
            }
          }
        }

        score++;
        scoreElement.textContent = score;
      }
    }
  }

  let score = 0;

  draw();

  setInterval(() => {
    movePiece('down');
  }, 500);

  document.addEventListener('keydown', (event) => {
    if (event.code === 'ArrowLeft') {
      movePiece('left');
    } else if (event.code === 'ArrowRight') {
      movePiece('right');
    } else if (event.code === 'ArrowDown') {
      movePiece('down');
    } else if (event.code === 'ArrowUp') {
      movePiece('rotate');
    }
  });
</script>
</body>
</html>