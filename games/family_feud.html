<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>

    </style>
</head>
<body>
<input type="text" id="topic" name="topic" placeholder="Topic">
<button id="send" name="send">Send</button>

<script>
    const topicInput = document.querySelector('#topic');
    const sendButton = document.querySelector('#send');

    function handleResponse(response) {
        const responseContent = response.choices[0].message.content;
        const responseJsonStr = responseContent.substring(responseContent.indexOf("{"), responseContent.lastIndexOf("}") + 1);
        const responseJsonData = JSON.parse(responseJsonStr);

        console.log(responseJsonData);
    }

    function getMessageData() {
        let topic = topicInput.value || 'random';
        const messages = [
            {
                "role": "user",
                "content": "[user] You are now a Family Feud API. As input parameters you accept \"topic\". From this topic you will create a random question in the style of Family Feud. If the topic is \"random\" you will create a random question for a random topic. You will create 8 answers with values that represent the number of (imaginary) people who voted for that answer.\nThe response should be in JSON format. E.g.:\n```\n{\n  \"question\": \"Name a popular pizza topping.\",\n  \"answers\": [\n    {\"answer\": \"Pepperoni\", \"value\": 35},\n    {\"answer\": \"Cheese\", \"value\": 20},\n    {\"answer\": \"Sausage\", \"value\": 15},\n    {\"answer\": \"Mushrooms\", \"value\": 10},\n    {\"answer\": \"Onions\", \"value\": 5},\n    {\"answer\": \"Ham\", \"value\": 5},\n    {\"answer\": \"Pineapple\", \"value\": 5},\n    {\"answer\": \"Olives\", \"value\": 5}\n  ]\n}\n```\n\nWrite \"OK\" if you understood all your instructions and are ready to receive a topic as input. After receiving the topic, you must respond in JSON format!\n\n"
            },
            {
                "role": "assistant",
                "content": "[assistant] OK. Please provide a topic.\n\n"
            },
            {
                "role": "user",
                "content": `Topic: ${topic}. Respond in the JSON format I provided in the first message.`
            }
        ];

        return messages;
    }

    sendButton.addEventListener('click', e => {
        var xhr = new XMLHttpRequest();
        xhr.open("POST", "https://chatgpt.tobiasmue91.workers.dev/");
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.setRequestHeader("Accept", "*/*");
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                handleResponse(JSON.parse(xhr.responseText));
            }
        };
        const requestData = {
            "model": "gpt-3.5-turbo-0301",
            "max_tokens": 1024,
            "messages": getMessageData(),
        }
        xhr.send(JSON.stringify(requestData));
    })
</script>
</body>
</html>