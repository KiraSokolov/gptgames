<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Solitaire</title>
  <style>
    .solitaire {
      display: flex;
      flex-direction: row;
      justify-content: space-between;
    }
    .foundation-pile {
      width: 100px;
      height: 150px;
      border: 1px solid black;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 2rem;
    }
    .stock-pile {
      width: 100px;
      height: 150px;
      border: 1px solid black;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 2rem;
    }
    .waste-pile {
      width: 100px;
      height: 150px;
      border: 1px solid black;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 2rem;
    }
    .playing-area {
      display: flex;
      flex-direction: row;
      justify-content: space-between;
      flex-wrap: wrap;
    }
    .column {
      width: 100px;
      height: 500px;
      border: 1px solid black;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 1rem;
    }
    .card {
      width: 80px;
      height: 116.8px;
      border: 1px solid black;
      border-radius: 5px;
      margin-top: -0.5rem;
      cursor: pointer;
      position: relative;
      z-index: 1;
    }
    .face-down {
      background-color: #006600;
      background-image: url("cards/red_joker.png");
      background-size: cover;
    }
    .face-up {
      background-color: #006600;
      background-size: cover;
    }
    .move-counter {
      width: 100px;
      height: 50px;
      border: 1px solid black;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 2rem;
    }
    .timer {
      width: 100px;
      height: 50px;
      border: 1px solid black;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 2rem;
    }
  </style>
</head>
<body>
<div class="solitaire">
  <div class="foundation-pile spades"></div>
  <div class="foundation-pile hearts"></div>
  <div class="foundation-pile diamonds"></div>
  <div class="foundation-pile clubs"></div>
  <div class="stock-pile"></div>
  <div class="waste-pile"></div>
  <div class="playing-area">
    <div class="column" data-cards="1"></div>
    <div class="column" data-cards="2"></div>
    <div class="column" data-cards="3"></div>
    <div class="column" data-cards="4"></div>
    <div class="column" data-cards="5"></div>
    <div class="column" data-cards="6"></div>
    <div class="column" data-cards="7"></div>
  </div>
  <div class="move-counter">Moves: 0</div>
  <div class="timer">Time: 0 seconds</div>
</div>
<script>
  const suits = ["clubs","diamonds","hearts","spades"];
  const values = [ "2","3","4","5","6","7","8","9","10","jack","queen","king","ace"];
  const deck = [];

  for (let suit of suits){
    for (let value of values){
      deck.push(`${value}_of_${suit}`);
    }
  }

  const solitaire = document.querySelector(".solitaire");
  const foundationPiles = document.querySelectorAll(".foundation-pile");
  const stockPile = document.querySelector(".stock-pile");
  const wastePile = document.querySelector(".waste-pile");
  const playingArea = document.querySelector(".playing-area");
  const columns = document.querySelectorAll(".column");
  const moveCounter = document.querySelector(".move-counter");
  const timer = document.querySelector(".timer");

  let moves = 0;
  let startTime;
  let timerInterval;

  function shuffle(array){
    for (let i = array.length - 1;i>0;i--){
      const j = Math.floor(Math.random() * (i + 1));
      [array[i],array[j]] = [array[j],array[i]];
    }
  }

  function dealCards(){
    shuffle(deck);

    let cardIndex = 0;

    for (let i = 0;i<7;i++){
      const columnCards = columns[i].dataset.cards;
      const cards = [];

      for (let j = 0;j<columnCards;j++){
        const card = document.createElement("div");
        card.classList.add("card");

        if (j === columnCards - 1){
          card.classList.add("face-up");
        } else {
          card.classList.add("face-down");
        }

        card.dataset.suit = deck[cardIndex].split("_")[2];
        card.dataset.value = deck[cardIndex].split("_")[0];
        card.style.backgroundImage = `url(cards/${deck[cardIndex]}.png)`;

        cards.push(card);
        columns[i].appendChild(card);

        cardIndex++;
      }

      cards[cards.length - 1].addEventListener("click", () => {
        const {suit, value} = cards[cards.length - 1].dataset;

        for (let pile of foundationPiles){
          const topCard = pile.lastElementChild;

          if (topCard){
            const topSuit = topCard.dataset.suit;
            const topValue = topCard.dataset.value;

            if (topSuit === suit && values.indexOf(topValue) === values.indexOf(value) - 1){
              pile.appendChild(cards[cards.length - 1]);
              moves++;
              moveCounter.textContent = `Moves:${moves}`;
              checkForWin();
              return;
            }
          } else {
            if (value === "ace"){
              pile.appendChild(cards[cards.length - 1]);
              moves++;
              moveCounter.textContent = `Moves:${moves}`;
              checkForWin();
              return;
            }
          }
        }
      });
    }

    for (let i = cardIndex;i<deck.length;i++){
      const card = document.createElement("div");
      card.classList.add("card");
      card.classList.add("face-down");
      card.dataset.suit = deck[i].split("_")[2];
      card.dataset.value = deck[i].split("_")[0];
      card.style.backgroundImage = `url(cards/${deck[i]}.png)`;
      stockPile.appendChild(card);
    }
  }

  function checkForWin(){
    let win = true;

    for (let pile of foundationPiles){
      if (pile.childElementCount !== 13){
        win = false;
        break;
      }
    }

    if (win){
      clearInterval(timerInterval);
      setTimeout(() => alert("You win!"), 500);
    }
  }

  function startTimer(){
    startTime = Date.now();
    timerInterval = setInterval(() => {
      const elapsedTime = Date.now() - startTime;
      const seconds = Math.floor(elapsedTime / 1000);
      timer.textContent = `Time:${seconds} seconds`;
    }, 1000);
  }

  function init(){
    dealCards();
    startTimer();

    stockPile.addEventListener("click", () => {
      if (stockPile.childElementCount === 0){
        while (wastePile.childElementCount > 0){
          const card = wastePile.lastElementChild;
          card.classList.remove("face-up");
          card.classList.add("face-down");
          stockPile.appendChild(card);
        }
      } else {
        const card = stockPile.lastElementChild;
        card.classList.remove("face-down");
        card.classList.add("face-up");
        wastePile.appendChild(card);
      }
    });

    wastePile.addEventListener("click", () => {
      const {suit, value} = wastePile.lastElementChild.dataset;

      for (let pile of foundationPiles){
        const topCard = pile.lastElementChild;

        if (topCard){
          const topSuit = topCard.dataset.suit;
          const topValue = topCard.dataset.value;

          if (topSuit === suit && values.indexOf(topValue) === values.indexOf(value) - 1){
            pile.appendChild(wastePile.lastElementChild);
            moves++;
            moveCounter.textContent = `Moves:${moves}`;
            checkForWin();
            return;
          }
        } else {
          if (value === "ace"){
            pile.appendChild(wastePile.lastElementChild);
            moves++;
            moveCounter.textContent = `Moves:${moves}`;
            checkForWin();
            return;
          }
        }
      }
    });

    for (let column of columns){
      column.addEventListener("click", (event) => {
        console.log('cliock column');
        const card = event.target;
        const {suit, value} = card.dataset;

        if (card.classList.contains("face-up")){
          for (let pile of foundationPiles){
            const topCard = pile.lastElementChild;

            if (topCard){
              const topSuit = topCard.dataset.suit;
              const topValue = topCard.dataset.value;

              if (topSuit === suit && values.indexOf(topValue) === values.indexOf(value) - 1){
                pile.appendChild(card);
                moves++;
                moveCounter.textContent = `Moves:${moves}`;
                checkForWin();
                return;
              }
            } else {
              if (value === "ace"){
                pile.appendChild(card);
                moves++;
                moveCounter.textContent = `Moves:${moves}`;
                checkForWin();
                return;
              }
            }
          }

          for (let otherCard of card.parentElement.children){
            if (otherCard.classList.contains("face-up")){
              const otherSuit = otherCard.dataset.suit;
              const otherValue = otherCard.dataset.value;

              if (suits.indexOf(otherSuit) % 2 !== suits.indexOf(suit) % 2 && values.indexOf(otherValue) === values.indexOf(value) - 1){
                const cardsToMove = [...card.parentElement.children].splice(otherCard.dataset.order);
                cardsToMove.forEach((cardToMove) => {
                  cardToMove.classList.add("moving");
                });
                setTimeout(() => {
                  cardsToMove.forEach((cardToMove) => {
                    cardToMove.classList.remove("moving");
                    cardToMove.classList.toggle("face-up");
                    card.parentElement.appendChild(cardToMove);
                  });
                  moves++;
                  moveCounter.textContent = `Moves:${moves}`;
                  checkForWin();
                }, 500);
                return;
              }
            }
          }
        } else {
          if (card === column.lastElementChild){
            card.classList.toggle("face-up");
          }
        }
      });
    }
  }

  init();
</script>
</body>
</html>