<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Sudoku Game</title>
  <style>
      body {
          font-family: Arial, sans-serif;
          text-align: center;
      }

      h1 {
          margin-top: 50px;
      }

      #game-container {
          display: inline-block;
          background-color: #ddd;
          padding: 50px;
          border-radius: 10px;
          box-shadow: 0 0 10px #999;
      }

      table {
          margin: 0 auto;
          border-collapse: collapse;
      }

      td {
          width: 50px;
          height: 50px;
          text-align: center;
          vertical-align: middle;
          border: 1px solid #333;
      }

      td:first-child {
          border-left:solid;
      }
      td:nth-child(3n) {
          border-right:solid ;
      }
      tr:first-child {
          border-top:solid;
      }
      tr:nth-child(3n) td {
          border-bottom:solid ;
      }

      .filled {
          background-color: #eee;
      }

      .selected {
          background-color: #ff0;
      }

      #controls {
          margin-top: 20px;
      }

      button {
          margin-right: 20px;
      }

      .number-picker button {
          padding: 4px 8px;
          cursor: pointer;
      }
  </style>
</head>
<body>
<h1>Sudoku Game</h1>
<div id="game-container">
  <table id="board">
    <!-- table cells will be dynamically generated by JavaScript -->
  </table>
  <div id="controls">
    <button id="new-game-button">New Game</button>
    <label for="difficulty-select">Difficulty:</label>
    <select id="difficulty-select">
      <option value="easy">Easy</option>
      <option value="medium">Medium</option>
      <option value="hard">Hard</option>
    </select>
  </div>
</div>
<script>
  const board = document.querySelector("#board");
  const newGameButton = document.querySelector("#new-game-button");
  const difficultySelect = document.querySelector("#difficulty-select");

  let game;

  class Game {
    constructor(difficulty) {
      this.difficulty = difficulty;
      this.board = [];
      this.generateBoard();
    }

    generateBoard() {
      this.board = [];

      // Initialize an empty board
      for (let i = 0; i < 9; i++) {
        this.board.push(Array(9).fill(""));
      }

      // Fill in a certain number of cells based on the difficulty
      switch (this.difficulty) {
        case "easy":
          this.fillRandomCells(40);
          break;
        case "medium":
          this.fillRandomCells(25);
          break;
        case "hard":
          this.fillRandomCells(20);
          break;
      }

      if (!this.isSolvable()) {
        this.generateBoard.bind(this);
      } else {
        this.render();
      }
    }

    fillRandomCells(numCells) {
      let count = 0;
      while (count < numCells) {
        const row = Math.floor(Math.random() * 9);
        const col = Math.floor(Math.random() * 9);
        const num = Math.floor(Math.random() * 9) + 1;
        if (this.isValidMove(this.board, row, col, num)) {
          this.board[row][col] = num;
          count++;
        }
      }
    }

    isValidMove(board, row, col, num) {
      // Check if the number is already in the row
      for (let i = 0; i < 9; i++) {
        if (board[row][i] === num) {
          return false;
        }
      }

      // Check if the number is already in the column
      for (let i = 0; i < 9; i++) {
        if (board[i][col] === num) {
          return false;
        }
      }

      // Check if the number is already in the 3x3 box
      const boxRowStart = Math.floor(row / 3) * 3;
      const boxColStart = Math.floor(col / 3) * 3;
      for (let i = 0; i < 3; i++) {
        for (let j = 0; j < 3; j++) {
          if (board[boxRowStart + i][boxColStart + j] === num) {
            return false;
          }
        }
      }

      return true;
    }

    render() {
      // Clear any existing content in the table
      board.innerHTML = "";

      // Generate table cells for the board
      for (let row = 0; row < 9; row++) {
        const tr = document.createElement("tr");
        for (let col = 0; col < 9; col++) {
          const td = document.createElement("td");
          td.textContent = this.board[row][col];
          if (this.board[row][col] !== "") td.classList.add("filled");
          td.addEventListener("click", () => {
            // Remove the "selected" class from all cells
            const allTds = document.querySelectorAll("td");
            for (const td of allTds) {
              td.classList.remove("selected");
            }

            // Add the "selected" class to the clicked cell
            td.classList.add("selected");

            document.querySelectorAll('.number-picker').forEach(element => element.remove());

            const picker = document.createElement("div");
            picker.classList.add("number-picker");
            for (let i = 1; i <= 9; i++) {
              const button = document.createElement("button");
              button.textContent = i;
              button.classList.add(`button-${i}`)
              button.addEventListener("click", () => {
                td.textContent = i;
                td.classList.remove("selected");
                td.classList.add("filled");
                this.board[row][col] = i;
                picker.remove();

                if (this.checkForWin()) {
                  alert("Congratulations! You have solved the Sudoku!");
                }
              });
              picker.appendChild(button);
            }
            document.body.appendChild(picker);
          });
          tr.appendChild(td);
        }
        board.appendChild(tr);
      }

      document.addEventListener("keydown", event => {
        // Check if a number key is pressed
        if (event.key >= "1" && event.key <= "9") {
          const selectedCell = document.querySelector(".selected");
          if (selectedCell) {
            // Find the corresponding number picker button and click it
            const picker = document.querySelector(".number-picker");
            if (picker) {
              const button = picker.querySelector(`.button-${event.key}`);
              if (button) {
                button.click();
              }
            }
          }
        }
      });
    }

    checkForWin() {
      for (let row = 0; row < 9; row++) {
        for (let col = 0; col < 9; col++) {
          if (this.board[row][col] === "") {
            return false;
          }
        }
      }

      for (let row = 0; row < 9; row++) {
        for (let col = 0; col < 9; col++) {
          const num = this.board[row][col];

          // Check if the number is already in the row
          for (let i = 0; i < 9; i++) {
            if (i !== col && this.board[row][i] === num) {
              return false;
            }
          }

          // Check if the number is already in the column
          for (let i = 0; i < 9; i++) {
            if (i !== row && this.board[i][col] === num) {
              return false;
            }
          }

          // Check if the number is already in the 3x3 box
          const boxRowStart = Math.floor(row / 3) * 3;
          const boxColStart = Math.floor(col / 3) * 3;
          for (let i = 0; i < 3; i++) {
            for (let j = 0; j < 3; j++) {
              if ((boxRowStart + i !== row || boxColStart + j !== col) && this.board[boxRowStart + i][boxColStart + j] === num) {
                return false;
              }
            }
          }
        }
      }

      return true;
    }

    isSolvable() {
      let solvedBoard = this.board.map(row => row.slice());
      let solvable = this.solvePuzzle(solvedBoard);
      return solvable && this.isUniqueSolution(solvedBoard);
    }

    solvePuzzle(board) {
      for (let row = 0; row < 9; row++) {
        for (let col = 0; col < 9; col++) {
          if (board[row][col] === "") {
            for (let num = 1; num <= 9; num++) {
              if (this.isValidMove(board, row, col, num)) {
                board[row][col] = num;
                if (this.solvePuzzle(board)) {
                  return true;
                }
                board[row][col] = "";
              }
            }
            return false;
          }
        }
      }
      return true;
    }

    isUniqueSolution(board) {
      let solvedBoard = board.map(row => row.slice());
      let solvable = this.solvePuzzle(solvedBoard);
      if (!solvable) {
        return false;
      }
      for (let row = 0; row < 9; row++) {
        for (let col = 0; col < 9; col++) {
          if (board[row][col] !== solvedBoard[row][col]) {
            return false;
          }
        }
      }
      return true;
    }
  }

  newGameButton.addEventListener("click", () => {
    const difficulty = difficultySelect.value;
    game = new Game(difficulty);
    game.render();
  });

  // Initialize the game when the page loads
  game = new Game("easy");
  game.render();
</script>
<script src="../sidebar.js"></script>
</body>
</html>