<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ChatGPT</title>
  <style>
    textarea {
      width: 50vw;
      height: 30vh;
    }
  </style>
</head>
<body>
<h1>ChatGPT</h1>
<textarea id="input" placeholder="Enter your message here..."></textarea><br><br>
<button id="submit">Send</button>
<button id="save">Save</button>
<button id="load">Load</button><br><br>
<textarea id="output" placeholder="Conversation will appear here..." disabled></textarea>

<script>
  const url = 'https://api.openai.com/v1/chat/completions';
  const apiKey = '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';

  const requestHeaders = {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${apiKey}`
  };

  const inputTextarea = document.getElementById('input');
  const submitButton = document.getElementById('submit');
  const outputTextarea = document.getElementById('output');
  const saveButton = document.getElementById('save');
  const loadButton = document.getElementById('load');

  let conversation = [];

  function addMessageToConversation(role, message) {
    const formattedMessage = `[${role}] ${message}\n\n`;
    conversation.push(formattedMessage);
    outputTextarea.value = conversation.join('');
  }

  submitButton.addEventListener('click', () => {
    const messages = conversation.map(message => {
      const role = message.includes('[user]') ? 'user' : 'assistant';
      const content = message.replace(/\[.*?\]\s/, '');
      return { role, content };
    });
    messages.push({ role: 'user', content: inputTextarea.value.trim() });

    const requestData = {
      model: 'gpt-3.5-turbo-0301',
      max_tokens: 400,
      messages
    };

    fetch(url, {
      method: 'POST',
      headers: requestHeaders,
      body: JSON.stringify(requestData)
    })
            .then(response => response.json())
            .then(data => {
              const message = data.choices[0].message.content.trim();
              addMessageToConversation('assistant', message);
              inputTextarea.value = '';
            })
            .catch(error => console.log(error));

    addMessageToConversation('user', inputTextarea.value.trim());
  });

  saveButton.addEventListener('click', () => {
    const inputContent = inputTextarea.value.trim();
    const outputContent = outputTextarea.value.trim();
    localStorage.setItem('input', inputContent);
    localStorage.setItem('output', outputContent);
  });

  loadButton.addEventListener('click', () => {
    const inputContent = localStorage.getItem('input');
    const outputContent = localStorage.getItem('output');
    if (inputContent) {
      inputTextarea.value = inputContent;
    }
    if (outputContent) {
      outputTextarea.value = outputContent;
      conversation = outputContent.split('\n\n').filter(message => message !== '');
    }
  });

</script>
</body>
</html>