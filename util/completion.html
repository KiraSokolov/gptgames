<!DOCTYPE html>
<html>
<head>
    <title>API Request</title>
    <style>
        textarea {
            width: 50vw;
            height: 30vh;
        }
    </style>
</head>
<body>
<form>
    <label for="prompt">Prompt:</label>
    <textarea id="prompt" name="prompt"></textarea><br/>
    <input type="submit" value="Submit"/>
</form>
<br/>
<label for="result">Result:</label>
<textarea id="result" name="result" readonly></textarea>
<script>
    var form = document.querySelector('form');
    var prompt = document.querySelector('#prompt');
    var result = document.querySelector('#result');
    const model = 'code-davinci-002';

    function sendRequest(url, data, headers) {
        return fetch(url, {
            method: 'POST',
            headers: headers,
            body: JSON.stringify(data)
        }).then(function (response) {
            if (response.ok) {
                return response.json();
            } else if (response.status === 429) {
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        resolve(sendRequest(url, data, headers));
                    }, 15000);
                });
            } else {
                throw new Error(response.statusText);
            }
        });
    }

    form.addEventListener('submit', function (e) {
        e.preventDefault();
        var url = 'https://api.openai.com/v1/completions';
        var data = {
            model: model,
            prompt: prompt.value,
            max_tokens: 64,
            temperature: 0,
            "frequency_penalty": 0.0,
            "presence_penalty": 0.0,
        };
        var token = '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';
        var headers = {
            Authorization: 'Bearer ' + token,
            'Content-Type': 'application/json'
        };
        sendRequest(url, data, headers)
            .then(function (json) {
                var output = '';
                json.choices.forEach(function (choice, index) {
                    output += 'Choice ' + (index + 1) + ': ' + choice.text + '\n';
                });
                result.value = output;
            })
            .catch(function (error) {
                result.value = 'Error: ' + error.message;
            });
    });
</script>
</body>
</html>