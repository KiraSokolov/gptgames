<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vue 3 Scientific Calculator</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/10.6.4/math.min.js" integrity="sha512-iphNRh6dPbeuPGIrQbCdbBF/qcqadKWLa35YPVfMZMHBSI6PLJh1om2xCTWhpVpmUyb4IvVS9iYnnYMkleVXLA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">
<div id="app" class="container mx-auto py-10">
  <div class="bg-white p-6 rounded-lg shadow-md w-full md:w-96 mx-auto">
    <input type="text" readonly v-model="result" class="w-full p-2 mb-2 bg-gray-100 rounded-lg text-right" />
    <div class="grid grid-cols-4 gap-2">
      <button @click="clear" class="p-2 bg-red-500 text-white font-bold rounded-lg">C</button>
      <template v-for="func in functions">
        <button @click="appendFunction(func)" class="p-2 bg-blue-500 text-white font-bold rounded-lg">{{ func }}</button>
      </template>
      <button @click="appendOperator(op)" v-for="op in operators" class="p-2 bg-yellow-500 text-white font-bold rounded-lg">{{ op }}</button>
      <div></div>
      <div></div>
      <template v-for="(numrow, index) in numbers">
        <button v-if="index===1" @click="memoryStore" class="p-2 bg-orange-500 text-white font-bold rounded-lg">MS</button>
        <button v-if="index===2" @click="memoryRecall" class="p-2 bg-orange-500 text-white font-bold rounded-lg">MR</button>
        <button v-if="index===3" @click="memoryClear" class="p-2 bg-orange-500 text-white font-bold rounded-lg">MC</button>
        <template v-for="num in numrow">
          <button @click="appendNumber(num)" class="p-2 bg-gray-200 font-bold rounded-lg">{{ num }}</button>
        </template>
      </template>
      <button @click="calculate" class="p-2 bg-green-500 text-white font-bold rounded-lg">=</button>
      <button @click="usePreviousResult" class="p-2 bg-purple-500 text-white font-bold rounded-lg">Ans</button>
    </div>
  </div>
</div>
<script>
  const app = Vue.createApp({
    data() {
      return {
        result: '',
        previousResult: '',
        memory: '',
        numbers: [
          [7, 8, 9],
          [4, 5, 6],
          [1, 2, 3],
          ['00', 0, '.']
        ],
        operators: ['+', '-', '*', '/', '^'],
        functions: ['sin', 'cos', 'tan', 'log', 'ln', 'sqrt', '(', ')', 'pi', 'e', 'abs', 'exp']
      };
    },
    created() {
      window.addEventListener('keydown', this.onKeyDown);
    },
    unmounted() {
      window.removeEventListener('keydown', this.onKeyDown);
    },
    methods: {
      appendNumber(num) {
        this.result += num;
      },
      appendOperator(op) {
        if (this.operators.includes(this.result.slice(-1))) return;
        this.result += op;
      },
      appendFunction(func) {
        if (func === '(' || func === ')') {
          this.result += func;
        } else if (func === 'pi') {
          this.result += Math.PI;
        } else if (func === 'e') {
          this.result += Math.E;
        } else {
          this.result += func + '(';
        }
      },
      calculate() {
        try {
          this.previousResult = this.result;
          this.result = math.evaluate(this.result).toString();
        } catch (error) {
          this.result = 'Error';
        }
      },
      clear() {
        this.result = '';
      },
      usePreviousResult() {
        this.result += this.previousResult;
      },
      memoryStore() {
        this.memory = this.result;
      },
      memoryRecall() {
        this.result += this.memory;
      },
      memoryClear() {
        this.memory = '';
      },
      onKeyDown(event) {
        const key = event.key;
        if (this.numbers.flat().includes(Number(key)) || this.operators.includes(key) || key === '(' || key === ')') {
          this.result += key;
        } else if (key === 'Enter') {
          this.calculate();
        } else if (key === 'Escape' || key === 'Delete' || key === 'Backspace') {
          this.clear();
        } else if (key === 'ArrowUp') {
          this.usePreviousResult();
        } else if (key === ',') {
          this.result += key;
        }
      }
    }
  });

  app.mount('#app');
</script>
</body>
</html>