<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Argumentator - Argument Generation Page</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://unpkg.com/json5@2/dist/index.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 0 auto;
    }
    .container {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    .generated-argument {
      border: 1px solid #ccc;
      padding: 10px;
      border-radius: 5px;
      cursor: pointer;
    }
    .generated-argument:hover {
      background-color: #f1f1f1;
    }
    #argumentator {
      display: flex;
      flex-direction: column;
    }
    #argumentator > * {
      margin-bottom: 20px;
    }
    #characteristics {
      min-height: 140px;
    }
  </style>
</head>
<body>
<div id="app" class="container">
  <h1>Argument Generation</h1>
  <div id="argumentator" v-if="!isGenerating && arguments.length === 0">
    <label for="topic">Topic:</label>
    <input id="topic" type="text" v-model="topic">

    <label for="characteristics">Select Argument Characteristics:</label>
    <select id="characteristics" multiple v-model="selectedCharacteristics">
      <option v-for="char in characteristics" :value="char">{{ char }}</option>
    </select>

    <label for="numArgs">Number of Arguments: {{ numArguments }}</label>
    <input id="numArgs" type="range" min="1" max="10" v-model="numArguments">

    <button @click="generateArguments">Generate Arguments</button>
  </div>
  <div v-else-if="isGenerating">
    Generating arguments... Please wait.
  </div>

  <div v-if="arguments.length > 0">
    <h2>Generated Arguments</h2>
    <div class="generated-argument" v-for="(arg, index) in arguments" @click="copyToClipboard(arg)">
      {{ index + 1 }}. {{ arg }}
    </div>
  </div>
</div>
<script>
  const app = Vue.createApp({
    data() {
      return {
        topic: '',
        characteristics: ['Populistic', 'Scientific', 'Factual', 'Emotional', 'Aggravating', 'Provocative', 'Humorous', 'Philosophical', 'Concise', 'Empathetic', 'Inspirational', 'Historical', 'Legal', 'Anecdotal', 'Moral/Ethical', 'Undeniable/Indisputable'],
        selectedCharacteristics: [],
        numArguments: 1,
        arguments: [],
        apiUrl: 'https://chatgpt.tobiasmue91.workers.dev/',
        isGenerating: false,
      };
    },
    methods: {
      async generateArguments() {
        // Call the ChatGPT API with the necessary parameters and store the result in this.arguments
        this.isGenerating = true;
        this.arguments = await this.callChatGptAPI();
        this.isGenerating = false;
      },
      async callChatGptAPI() {
        let response = await fetch(this.apiUrl, {
          'method': 'POST',
          'headers': {
            "Content-Type": "application/json",
            "Accept": "*/*"
          },
          'body': JSON.stringify(this.requestData())
        });

        if (!response.ok) {
          throw new Error('Network response was not ok');
        }

        let data = await response.json();
        const responseContent = data.choices[0].message.content;
        const responseJsonStr = responseContent.substring(
                responseContent.indexOf("{"),
                responseContent.lastIndexOf("}") + 1
        );
        const responseJsonData = JSON5.parse(responseJsonStr);

        return responseJsonData['arguments'];
      },
      requestData() {
        return {
          model: "gpt-3.5-turbo-0301",
          max_tokens: 2048,
          messages: this.messageData,
        };
      },
      copyToClipboard(text) {
        const textarea = document.createElement('textarea');
        textarea.value = text;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
      }
    },
    computed: {
      messageData() {
        return [
          {
            role: "assistant",
            content: `I am now an API for generating arguments based on user-defined characteristics. On my next message, I will respond in JSON format and provide an array of arguments tailored to the given topic and selected argument characteristics. The JSON format will be as follows: {"arguments":[{"characteristics":["CHARACTERISTIC1","CHARACTERISTIC2",...],"argument":"ARGUMENT_TEXT"}, ...]}. The selected argument characteristics are: ["${this.characteristicsString}]. The user has chosen to generate ${this.numArguments} arguments for the topic "${this.topic}". Please confirm with "OCK!" and I will send you the arguments in the next message.`,
          },
          {
            role: "user",
            content: `OCK!`,
          },
        ];
      },
      characteristicsString() {
        return this.selectedCharacteristics.join(', ');
      }
    }
  }).mount('#app');
</script>

</body>
</html>