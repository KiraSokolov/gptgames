<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Image Watermark Tool</title>
	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" crossorigin="anonymous">
	<!-- Font Awesome -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" crossorigin="anonymous" />
	<style>
		body {
			background-color: #f8f9fa;
		}
		.container {
			margin-top: 50px;
			background-color: #fff;
			padding: 30px;
			border-radius: 10px;
			box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
		}
		.form-group {
			margin-bottom: 20px;
		}
		.preview {
			margin-top: 20px;
			text-align: center;
		}
		.preview img {
			max-width: 100%;
			height: auto;
		}
		.watermark-options {
			margin-top: 20px;
		}
		.watermark-options label {
			font-weight: bold;
		}
		.watermark-options .form-group {
			margin-bottom: 10px;
		}
		.watermark-options .form-check {
			margin-bottom: 5px;
		}
		.watermark-options .form-check-label {
			margin-left: 5px;
		}
		.download-btn {
			margin-top: 20px;
			text-align: center;
		}
		.download-btn button {
			padding: 10px 20px;
			border-radius: 5px;
			background-color: #007bff;
			color: #fff;
			border: none;
			cursor: pointer;
			transition: all 0.3s ease;
		}
		.download-btn button:hover {
			background-color: #0069d9;
		}
	</style>
</head>
<body>
	<div class="container">
		<h1 class="text-center mb-4">Image Watermark Tool</h1>
		<form id="watermark-form">
			<div class="form-group">
				<label for="image-upload">Upload Image</label>
				<input type="file" class="form-control-file" id="image-upload" accept="image/*" required>
			</div>
			<div class="form-group">
				<label for="watermark-type">Watermark Type</label>
				<select class="form-control" id="watermark-type" required>
					<option value="text">Text</option>
					<option value="image">Image</option>
				</select>
			</div>
			<div class="form-group">
				<label for="watermark-text">Watermark Text</label>
				<input type="text" class="form-control" id="watermark-text" placeholder="Enter watermark text" required>
			</div>
			<div class="form-group">
				<label for="watermark-image-upload">Watermark Image</label>
				<input type="file" class="form-control-file" id="watermark-image-upload" accept="image/*">
			</div>
			<div class="form-group">
				<label for="watermark-position">Watermark Position</label>
				<select class="form-control" id="watermark-position" required>
					<option value="top-left">Top Left</option>
					<option value="top-center">Top Center</option>
					<option value="top-right">Top Right</option>
					<option value="middle-left">Middle Left</option>
					<option value="middle-center">Middle Center</option>
					<option value="middle-right">Middle Right</option>
					<option value="bottom-left">Bottom Left</option>
					<option value="bottom-center">Bottom Center</option>
					<option value="bottom-right">Bottom Right</option>
				</select>
			</div>
			<div class="form-group">
				<label for="watermark-size">Watermark Size</label>
				<input type="range" class="form-control-range" id="watermark-size" min="10" max="100" value="50" required>
			</div>
			<div class="form-group">
				<label for="watermark-opacity">Watermark Opacity</label>
				<input type="range" class="form-control-range" id="watermark-opacity" min="0" max="100" value="50" required>
			</div>
			<div class="form-group">
				<label for="watermark-color">Watermark Color</label>
				<input type="color" class="form-control" id="watermark-color" value="#000000" required>
			</div>
			<div class="form-group watermark-options">
				<label>Watermark Options</label>
				<div class="form-check">
					<input class="form-check-input" type="checkbox" id="watermark-repeat" checked>
					<label class="form-check-label" for="watermark-repeat">Repeat Watermark</label>
				</div>
				<div class="form-check">
					<input class="form-check-input" type="checkbox" id="watermark-transparent">
					<label class="form-check-label" for="watermark-transparent">Transparent Background</label>
				</div>
			</div>
			<div class="preview">
				<img id="preview-image" src="#" alt="Preview Image">
			</div>
			<div class="download-btn">
				<button type="submit" class="btn btn-primary btn-lg">Download Watermarked Image</button>
			</div>
		</form>
	</div>
	<!-- jQuery -->
	<script src="https://code.jquery.com/jquery-3.5.1.min.js" crossorigin="anonymous"></script>
	<!-- Bootstrap JS -->
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" crossorigin="anonymous"></script>
	<script>
		function updatePreview() {
			var watermarkType = $('#watermark-type').val();
			var watermarkText = $('#watermark-text').val();
			var watermarkImage = $('#watermark-image-preview').attr('src');
			var watermarkPosition = $('#watermark-position').val();
			var watermarkSize = $('#watermark-size').val();
			var watermarkOpacity = $('#watermark-opacity').val();
			var watermarkColor = $('#watermark-color').val();
			var watermarkRepeat = $('#watermark-repeat').prop('checked');
			var watermarkTransparent = $('#watermark-transparent').prop('checked');
			var canvas = document.createElement('canvas');
			var ctx = canvas.getContext('2d');
			var img = new Image();
			img.onload = function() {
				canvas.width = img.width;
				canvas.height = img.height;
				ctx.drawImage(img, 0, 0);
				if (watermarkType == 'text') {
					ctx.font = watermarkSize + 'px Arial';
					ctx.fillStyle = watermarkColor;
					ctx.globalAlpha = watermarkOpacity / 100;
					var position = getPosition(watermarkPosition, canvas.width, canvas.height, ctx.measureText(watermarkText).width, parseInt(watermarkSize));
					ctx.fillText(watermarkText, position.x, position.y);
				} else {
					var watermarkImg = new Image();
					watermarkImg.onload = function() {
						var position = getPosition(watermarkPosition, canvas.width, canvas.height, watermarkImg.width, watermarkImg.height);
						ctx.globalCompositeOperation = 'source-over';
						ctx.globalAlpha = watermarkOpacity / 100;
						ctx.drawImage(watermarkImg, position.x, position.y, watermarkImg.width, watermarkImg.height);
					}
					watermarkImg.src = watermarkImage;
				}
				if (watermarkTransparent) {
					var imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
					var data = imageData.data;
					for (var i = 0; i < data.length; i += 4) {
						if (data[i] == 255 && data[i + 1] == 255 && data[i + 2] == 255) {
							data[i + 3] = 0;
						}
					}
					ctx.putImageData(imageData, 0, 0);
				}
				$('#preview-image').attr('src', canvas.toDataURL('image/png'));
			}
			img.src = $('#preview-image').attr('src');
		}

		$(document).ready(function() {
			// Preview uploaded image
			$('#image-upload').change(function() {
				var reader = new FileReader();
				reader.onload = function(e) {
					$('#preview-image').attr('src', e.target.result);
				}
				reader.readAsDataURL(this.files[0]);
			});

			// Toggle watermark type
			$('#watermark-type').change(function() {
				if ($(this).val() == 'text') {
					$('#watermark-text').prop('disabled', false);
					$('#watermark-image-upload').prop('disabled', true);
				} else {
					$('#watermark-text').prop('disabled', true);
					$('#watermark-image-upload').prop('disabled', false);
				}
				updatePreview();
			});

			// Preview watermark image
			$('#watermark-image-upload').change(function() {
				var reader = new FileReader();
				reader.onload = function(e) {
					$('#watermark-image-preview').attr('src', e.target.result);
				}
				reader.readAsDataURL(this.files[0]);
				updatePreview();
			});

			// Preview watermark
			$('#watermark-form').submit(function(e) {
				e.preventDefault();
				updatePreview();
				var downloadLink = document.createElement('a');
				downloadLink.download = 'watermarked-image.png';
				downloadLink.href = canvas.toDataURL('image/png');
				downloadLink.click();
			});

			$('#watermark-text').on('input', updatePreview);
			$('#watermark-position').change(updatePreview);
			$('#watermark-size').on('input', updatePreview);
			$('#watermark-opacity').on('input', updatePreview);
			$('#watermark-color').on('input', updatePreview);
			$('#watermark-repeat').change(updatePreview);
			$('#watermark-transparent').change(updatePreview);
		});

		function getPosition(position, canvasWidth, canvasHeight, watermarkWidth, watermarkHeight) {
			switch (position) {
				case 'top-left':
					return { x: 0, y: watermarkHeight };
				case 'top-right':
					return { x: canvasWidth - watermarkWidth, y: watermarkHeight };
				case 'bottom-left':
					return { x: 0, y: canvasHeight - watermarkHeight };
				case 'bottom-right':
					return { x: canvasWidth - watermarkWidth, y: canvasHeight - watermarkHeight };
				case 'center':
				default:
					return {
						x: (canvasWidth - watermarkWidth) / 2,
						y: (canvasHeight + watermarkHeight) / 2
					};
			}
		}
	</script>
</body>
</html>